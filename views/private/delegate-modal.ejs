<div class="js-modal-container modal-container">
  <div class="modal fade" id="js-list-modal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title" id="myModalLabel">出警确认</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-xs-12">
              <div class="list-info-row">
                <div class="list-title js-m-caseType">

                </div>
                <div class="list-number js-m-id">

                </div>
              </div>
              <div class="list-info-row row">
                <div class="list-first-info col-xs-12 col-sm-6">
                  <span class="list-info-item">报警人：</span><span class="list-info-value js-m-userName"></span>
                </div>
                <div class="list-second-info col-xs-12 col-sm-6">
                  <span class="list-info-item">身份证：</span><span class="list-info-value js-m-idCard"></span>
                </div>
              </div>
              <div class="list-info-row">
                <div class="list-first-info">
                  <span class="list-info-item">联系电话：</span><span class="list-info-value js-m-phoneNumber"></span>
                </div>
              </div>
              <div class="list-case-detail-info js-m-caseInfo">

              </div>
              <div class="list-case-map">
                <!-- 地图 -->
              </div>
              <div class="list-case-police-choice row">
                <div class="col-xs-6">
                  <select class="form-control js-officeName">
                    <option>派出所1</option>
                    <option>派出所2</option>
                  </select>
                </div>
                <div class="col-xs-6">
                  <select class="form-control js-policeName">
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary js-delegate-confirm">确认指派</button>
        </div>
      </div>
    </div>
    <div class="hidden-info-container">
      <div class="js-m-openid"></div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    var schema=['userName','phoneNumber','idCard','caseType','caseInfo','id','openid']//list绑定到modal时用的字段，定位两者的class名
    var bind=new BindingModal()

    function insertPolice(){//添加空闲民警到弹窗
      $.post(online+'getfreePolice',(data)=>{
        var policeArr=data.persons
        for(var i=0;i<policeArr.length;i++){
          $('.js-policeName').append($(`<option value="minjing${i+1}">minjing${i+1}</option>`))
        }
      })
    }

    $('.main-container').on('click','.js-show-modal',function(){
      bind.getPosition($(this))
      insertPolice()
      $('#js-list-modal').modal('show')
    })

    $('#js-list-modal')
    .on('show.bs.modal',function(){
      var openid=''

      bind.bindingInfo(schema)//绑定信息到弹窗
      openid=$('.js-m-openid').html().trim()

      global_getUserPosition(openid,(data)=>{//获取用户位置坐标，用于地图展示
        console.log(data.person.location)
      })
    })
    .on('hide.bs.modal',function(){
      $('.js-policeName').find('option').remove()
    })


    $('.js-delegate-confirm').on('click',function(){
      var _id=$('.js-m-id').html().trim(),
          policeName=$('.js-policeName').val()

      $.post(online+'delegate',{_id,policeName})
      $('#js-list-modal').modal('hide')
    })
  })
</script>
